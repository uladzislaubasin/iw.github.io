(this["webpackJsonpinstant-widgets-manager"]=this["webpackJsonpinstant-widgets-manager"]||[]).push([[0],{123:function(e,t,n){e.exports=n(146)},146:function(e,t,n){"use strict";n.r(t);var a,r=n(0),o=n.n(r),i=n(12),c=n.n(i),u=n(194),l=n(195),s=n(70),m=n(67),f=n(6),g=n(55),d=n(15),b=n(178),v=n(181),h=n(182),p=n(184),y=n(201),O=n(183),E=n(81),j=n(191),C=n(91),S=n(200),w=n(9),k=function(e){return o.a.createElement(r.Fragment,null,!Object(w.isNil)(e.error)&&o.a.createElement(p.a,{item:!0},o.a.createElement(S.a,{severity:"error"},e.error)))},D=n(149),T=n(187),N=n(186),M=Object(N.a)((function(e){return{backdrop:{zIndex:e.zIndex.modal+1}}})),P=function(e){var t=M();return o.a.createElement(r.Fragment,null,o.a.createElement(D.a,{className:t.backdrop,open:e.visible},o.a.createElement(T.a,null)))},F=n(96),I=n.n(F),W=n(28),x=n(20),A=function(){function e(t,n){Object(W.a)(this,e),this._promise=void 0,this._context=void 0,this._promise=t,this._context=n}return Object(x.a)(e,[{key:"asPromise",value:function(){return this._promise}},{key:"withContext",value:function(e){return this._context=e,this}},{key:"delay",value:function(e){return this._promise=this._promise.then((function(t){return new Promise((function(n){return setTimeout((function(){return n(t)}),e)}))})),this}},{key:"ensure",value:function(e,t){var n=this;if(!t)throw Error("Cannot ensure condition, since error is not defined");return this._promise=this._promise.then((function(a){return e.call(n._context,a)?Promise.resolve(a):Promise.reject(t)})),this}},{key:"ensureAsResult",value:function(t,n){return this.onSuccess((function(a){return t(a).onSuccess((function(t){return t?e.Ok(a):e.Fail(n)})).onFailure((function(t){return e.Fail(n)})).run()}))}},{key:"ensureAs",value:function(t,n,a){var r=this;return this.onSuccess((function(o){return t(o)?r.execute(a,o):(r.ignorePromiseError(),e.Fail(n))}))}},{key:"onSuccess",value:function(t){var n=this;return new e(this._promise.then((function(e){return n.execute(t,e)})),this._context)}},{key:"onSuccessWhen",value:function(e,t){return this.onSuccess((function(n){return e(n)?t(n):n}))}},{key:"onFailure",value:function(e){var t=this;return this._promise=this._promise.catch((function(n){throw e.call(t._context,n),n})),this}},{key:"onFailureCompensate",value:function(t){var n=this,a=this._promise;return new e(new Promise((function(e,r){a.then((function(t){return e(t)})).catch((function(a){var o="".concat(a);return a instanceof Error&&(o=a.message),n.execute(t,o).then((function(t){return e(t)})).catch((function(e){return r(e)}))}))})),this._context)}},{key:"recover",value:function(){return this.void.onFailureCompensate((function(e){}))}},{key:"onBoth",value:function(t){var n=this,a=!1;return this.onSuccess((function(e){return a=!0,t.call(n._context,n)})).onFailureCompensate((function(r){return a?e.Fail(r):t.call(n._context,n)}))}},{key:"withOverridenValue",value:function(t){return this.onSuccess((function(n){return e.Ok(t)}))}},{key:"withOverridenError",value:function(t){var n=this;return this.onFailureCompensate((function(a){return e.Fail(t,n._context)}))}},{key:"withProcessedError",value:function(t){var n=this;return this.onFailureCompensate((function(a){return e.Fail(t(a),n._context)}))}},{key:"run",value:function(){return this.runAsResult()._promise}},{key:"runAsResult",value:function(){return this.ignorePromiseError(),this}},{key:"transformBooleanSuccess",value:function(){return this.onSuccess((function(e){return!0})).onFailureCompensate((function(e){return!1}))}},{key:"ignorePromiseError",value:function(){this._promise.catch((function(e){}))}},{key:"execute",value:function(t,n){this.run();var a=t.call(this._context,n);return a instanceof Promise?a:a instanceof e?a.asPromise():Promise.resolve(a)}},{key:"void",get:function(){return this.onSuccess((function(e){}))}}],[{key:"Start",value:function(t){return e.Ok(!0,t)}},{key:"Ok",value:function(t,n){return new e(Promise.resolve(t),n)}},{key:"Void",value:function(){return e.Ok(void 0)}},{key:"Delay",value:function(t){return e.Void().delay(t)}},{key:"Fail",value:function(t,n){return new e(Promise.reject(t),n)}},{key:"FromPromise",value:function(t,n){return new e(t,n)}},{key:"Combine",value:function(t){var n=t.map((function(e){return e.asPromise()}));return new e(Promise.all(n))}},{key:"JoinFactories",value:function(t){var n=e.Ok([]);return t.forEach((function(e){n=n.onSuccess((function(t){return e().onSuccess((function(e){return t.concat([e])}))}))})),n}},{key:"Create",value:function(t,n,a){return t?e.Ok(!0,a):e.Fail(n,a)}},{key:"Retry",value:function(t,n,a,r){var o=this,i=new Promise((function(e,r){a().onSuccess((function(t){return e(t)})).onFailure((function(i){return o.retryInternal(t,0,n,a,i,e,r)})).run()}));return e.FromPromise(i,r)}},{key:"Wrap",value:function(t,n){return t?e.Ok(t):e.Fail(n)}},{key:"retryInternal",value:function(e,t,n,a,r,o,i){var c=this;e!==t?setTimeout((function(){return a().onSuccess((function(e){return o(e)})).onFailure((function(u){return c.retryInternal(e,t+1,n,a,r,o,i)})).run()}),n):i(r)}}]),e}(),B=new I.a({en:{loginTitle:"Login with your GitHub credentials",userName:"Username",pat:"Personal access token",instructions:"Instructions",login:"Login",loginFailed:"Login failed",noRepositoriesAvailable:"No repositories available",pickRepository:"Pick repository",startEditing:"Start editing",somethingWentWrong:"Something went wrong. Please, try again later",save:"Save",cancel:"Cancel",title:"Title",description:"Description",edit:"Edit",manageWidget:"Manage widget",image:"Image",removeImage:"Remove image",moreButton:"More button",link:"Link",audience:"Audience",availability:"Availability",fromDate:"From date",tillDate:"Till date",copy:"Copy",copyWidget:"Copy widget to environment",deleteWidget:"Delete widget",imageIsNotValid:"Image is not valid",someFieldsAreEmpty:"Some fields are empty",dateRangeIsInvalid:"Availability date range is invalid",createWidget:"Create widget",revertChanges:"Revert changes",areYouSureToRevert:"Are you sure you want to revert changes for ",areYouSureToPublish:"Are you sure you want to publish changes for ",publishChanges:"Publish changes",areYouSureToDeleteWidget:"Are you sure you want to delete this widget?",successfullyPublished:"Successfully published. Changes will appear in the app shortly",pngImagesOnly:"Format: PNG. Min size: ".concat(750,"x").concat(784,". Max size: ").concat(1500,"x").concat(1568)}}),U=n(71),R=new Map,_={debug:!1,debugDataKey:"debug_data",debugCountryKey:"debug_country",countries:[{name:"CH",languages:["en","de","it","fr"],environments:["JIT","UAT","PROD"]},{name:"AT",languages:["de"],environments:["JIT","UAT","PROD"]},{name:"GB",languages:["en"],environments:["JIT","UAT","PROD"]},{name:"NL",languages:["nl"],environments:["JIT","UAT","PROD"]},{name:"IE",languages:["en"],environments:["JIT","UAT","PROD"]},{name:"BY",languages:["by"],environments:["JIT","UAT","PROD"]},{name:"PL",languages:["pl","en"],environments:["JIT","UAT","PROD"]}]},Y=function(e){return _.debug?R.get(e)||localStorage.getItem(e):(localStorage.removeItem(e),R.get(e))},J=function(e){var t=L(e),n={method:e.method,headers:t,mode:"cors"};e.body&&(n.body=e.useJsonContentType?JSON.stringify(e.body):e.body);var a=z(e.path,e.queryParams);return A.FromPromise(fetch(a,n)).onSuccess((function(e){return e.status>=200&&e.status<300?A.Ok(e):A.Fail("".concat(e.status))}))},L=function(e){var t=Object(U.a)({},e.headers);return!0!==e.ignoreCacheControl&&(t={"If-Modified-Since":(new Date).toLocaleString()}),e.useJsonContentType&&(t=Object(U.a)({"Content-Type":"application/json"},t)),e.useAuthorization&&(t=Object(U.a)({Authorization:"Basic ".concat(Y("credentials"))},t)),t},z=function(e,t){return"".concat(e).concat(H(t))},H=function(e){if(!e)return"";var t=Object.keys(e).filter((function(t){return"boolean"===e[t]||!!e[t]})).map((function(t){return"".concat(t,"=").concat(e[t])})).join("&");return"?".concat(t)},G=function(e){return J(e).onSuccess((function(e){return e.json()}))},K=function(e){var t,n=e.toLowerCase();return null===(t=_.countries.map((function(e){return"".concat("capp-instantWidgets-").concat(e.name).toLowerCase()})).find((function(e){return e===n})))||void 0===t?void 0:t.substr("capp-instantWidgets-".length).toUpperCase()},V="https://api.github.com/",q=function(){var e={path:"".concat(V,"user/repos?per_page=1000"),method:"GET",useAuthorization:!0};return G(e).onSuccess((function(e){return e.filter((function(e){return t=e.name,!Object(w.isNil)(K(t))&&"LibertyGlobal"===e.owner.login;var t}))}))},X=function(e,t){_.debug?localStorage.setItem(e,t):localStorage.removeItem(e),R.set(e,t)},$=function(e,t){return function(e,t){X("credentials",btoa("".concat(e,":").concat(t)))}(e,t),q().withOverridenError(B.loginFailed).ensure((function(e){return e.length>0}),B.noRepositoriesAvailable).onSuccess((function(e){return function(e){X("Repositories",e)}(e)}))},Q=function(){var e=Object(d.e)(),t=Object(r.useState)(!1),n=Object(f.a)(t,2),a=n[0],i=n[1],c=Object(r.useState)(),u=Object(f.a)(c,2),l=u[0],s=u[1],m=Object(r.useState)(""),g=Object(f.a)(m,2),S=g[0],w=g[1],D=Object(r.useState)(""),T=Object(f.a)(D,2),N=T[0],M=T[1],F=Object(r.useCallback)((function(){i(!0),$(S,N).onFailure((function(e){return s(e)})).onSuccess((function(t){return e.replace("/pick")})).onBoth((function(e){return i(!1)})).run()}),[N,S,e]);return o.a.createElement(r.Fragment,null,o.a.createElement(b.a,{open:!0},o.a.createElement(v.a,null,B.loginTitle),o.a.createElement(h.a,{dividers:!0},o.a.createElement(p.a,{container:!0,spacing:2,direction:"column"},o.a.createElement(k,{error:l}),o.a.createElement(p.a,{item:!0},o.a.createElement(y.a,{autoFocus:!0,fullWidth:!0,required:!0,label:B.userName,type:"text",onChange:function(e){return w(e.target.value)}})),o.a.createElement(p.a,{item:!0},o.a.createElement(y.a,{fullWidth:!0,required:!0,label:B.pat,type:"password",onChange:function(e){return M(e.target.value)}})))),o.a.createElement(O.a,null,o.a.createElement(E.a,null,o.a.createElement(j.a,{target:"_blank",href:"https://github.com/instant-widgets-editor/instant-widgets-editor.github.io/blob/master/README.md#instant-widgets-editor"},B.instructions)),o.a.createElement(C.a,{variant:"contained",color:"primary",onClick:F},B.login))),o.a.createElement(P,{visible:a}))},Z=n(202),ee=n(192),te=n(199),ne=function(){var e=Object(d.e)(),t=Object(r.useState)([]),n=Object(f.a)(t,2),a=n[0],i=n[1],c=Object(r.useState)(),u=Object(f.a)(c,2),l=u[0],s=u[1];Object(r.useEffect)((function(){return i(Y("Repositories")||[])}),[]);var m=Object(r.useCallback)((function(e){return s(a.find((function(t){return t.name===e})))}),[a]),g=Object(r.useCallback)((function(){if(!Object(w.isNil)(l)){var t=K(l.name);Object(w.isNil)(t)||e.replace("/manage/country/".concat(t))}}),[l,e]);return o.a.createElement(b.a,{open:!0},o.a.createElement(v.a,null,B.pickRepository),o.a.createElement(h.a,{dividers:!0},o.a.createElement(Z.a,{onChange:function(e){return m(e.target.value)}},a.map((function(e){return o.a.createElement(ee.a,{value:e.name,key:e.name,control:o.a.createElement(te.a,null),label:e.name})})))),o.a.createElement(O.a,null,o.a.createElement(C.a,{variant:"contained",color:"primary",onClick:g},B.startEditing)))},ae=function(e){var t=e.onCompleted,n=Object(d.e)();return Object(r.useEffect)((function(){if(_.debug&&!Object(w.isNil)(localStorage.getItem(_.debugCountryKey)))return t(),void n.push("/manage/country/".concat(localStorage.getItem(_.debugCountryKey)));n.push("/login"),t()}),[t,n]),o.a.createElement(P,{visible:!0})},re=n(34),oe=n.n(re),ie=n(193),ce=Object(N.a)((function(e){return{container:{marginTop:e.spacing(4),marginBottom:e.spacing(2)}}})),ue=function(){var e=ce();return o.a.createElement(ie.a,{className:e.container})},le=n(72),se=n(203),me=function(){var e=Object(s.b)();return Object(r.useCallback)((function(t){return A.FromPromise(e({title:t}))}),[e])},fe=n(7),ge=function(e){var t;return(null===(t=_.countries.find((function(t){return t.name===e})))||void 0===t?void 0:t.languages)||[]};!function(e){e.broadband="BROADBAND",e.mobile="MOBILE",e.all="ALL"}(a||(a={}));var de=function(e){var t=ge(e);return{title:be(t),description:be(t),fromDate:new Date,tillDate:new Date,audience:a.all,imageUrl:"",button:{url:"",title:be(t)}}},be=function(e){return e.reduce((function(e,t){return Object.assign(e,Object(fe.a)({},t,""))}),{})},ve=n(197),he=n(21),pe=n.n(he),ye=n(97),Oe=n.n(ye),Ee=function(e,t){return Object(r.useMemo)((function(){return function(e,t){var n,a=null===(n=_.countries.find((function(t){return t.name===e})))||void 0===n?void 0:n.languages[0];return Object(w.isNil)(a)?Object.values(t)[0]:t[a]}(e,t)}),[e,t])},je=n(198),Ce=n(205),Se=function(e){var t;return(null===(t=_.countries.find((function(t){return t.name===e})))||void 0===t?void 0:t.environments)||[]},we=function(e){var t=e.onCopy,n=Object(r.useMemo)((function(){return Se(e.country)}),[e.country]),a=Object(r.useState)(n[0]),i=Object(f.a)(a,2),c=i[0],u=i[1],l=Object(r.useCallback)((function(){return c&&t(c)}),[t,c]);return o.a.createElement(b.a,{open:e.open,fullWidth:!0,maxWidth:"sm"},o.a.createElement(v.a,null,B.copyWidget),o.a.createElement(h.a,{dividers:!0},o.a.createElement(je.a,{onChange:function(e){return u(e.target.value||n[0])},fullWidth:!0,variant:"outlined"},n.map((function(e){return o.a.createElement(Ce.a,{key:e,value:e},e)})))),o.a.createElement(O.a,null,o.a.createElement(C.a,{variant:"contained",onClick:e.onCancel},B.cancel),o.a.createElement(C.a,{variant:"contained",color:"primary",onClick:l},B.copy)))},ke=n(98),De=n.n(ke),Te=function(e,t){return A.Void().onSuccess((function(e){return t&&function(e){var t=new Promise((function(t,n){var a=new Image;a.src=window.URL.createObjectURL(e),a.onload=function(){a.width<750||a.width>1500||a.height<784||a.height>1568?n():t()},a.onerror=function(){return n()}}));return A.FromPromise(t).withOverridenError(B.imageIsNotValid)}(t)})).onSuccess((function(t){return Ne(e.button.title)})).onSuccess((function(t){return Ne(e.description)})).onSuccess((function(t){return Ne(e.title)})).ensure((function(t){return pe()(e.fromDate).isBefore(e.tillDate)}),B.dateRangeIsInvalid).void},Ne=function(e){return Object.values(e).every((function(e){return!Object(w.isNil)(e)&&e.length>0}))?A.Void():A.Fail(B.someFieldsAreEmpty)},Me=function(e){var t="";return[].slice.call(new Uint8Array(e)).forEach((function(e){return t+=String.fromCharCode(e)})),btoa(t)},Pe=n(99),Fe=n(18),Ie=n(196),We=function(e){return o.a.createElement(r.Fragment,null,o.a.createElement(p.a,{item:!0},o.a.createElement(E.a,{variant:"h6"},e.title)),o.a.createElement(p.a,{item:!0},o.a.createElement(Fe.a,{utils:Pe.a},o.a.createElement(Ie.a,{inputVariant:"outlined",placeholder:e.title,margin:"normal",label:"DD/MM/YYYY",format:"DD/MM/YYYY",value:e.value,onChange:function(t){return e.onChange((null===t||void 0===t?void 0:t.toDate())||new Date)},invalidDateMessage:" ",maxDateMessage:" ",minDateMessage:" ",clearable:!0,fullWidth:!0}))))},xe=function(e){var t=Object(r.useMemo)((function(){return ge(e.country)}),[e.country]);return o.a.createElement(p.a,{item:!0,container:!0,direction:"column",spacing:2},!Object(w.isNil)(e.label)&&o.a.createElement(p.a,{item:!0},o.a.createElement(E.a,{variant:"h6"},e.label)),t.map((function(t){var n;return o.a.createElement(p.a,{item:!0,key:t},o.a.createElement(y.a,{fullWidth:!0,label:t,type:"text",variant:"outlined",error:0===(null===(n=e.value[t])||void 0===n?void 0:n.length),value:e.value[t],onChange:function(n){return e.onChange(n.target.value,t)}}))})))},Ae=Object(N.a)((function(e){return{fileUploadContainer:{flex:1}}})),Be=function(e){var t=e.onSave,n=e.onDelete,i=Object(r.useState)(0),c=Object(f.a)(i,2),u=c[0],l=c[1],s=Object(r.useState)(e.widget),m=Object(f.a)(s,2),g=m[0],d=m[1],j=Object(r.useState)(),S=Object(f.a)(j,2),D=S[0],T=S[1],N=Object(r.useState)(),M=Object(f.a)(N,2),P=M[0],F=M[1],I=Object(r.useState)(),W=Object(f.a)(I,2),x=W[0],U=W[1],R=Ae(),_=me();Object(r.useEffect)((function(){d(oe()(e.widget,{})),U(void 0)}),[e.widget,u]),Object(r.useEffect)((function(){return l((function(e){return e+1}))}),[e.open]);var Y=Object(r.useCallback)((function(e){e(g),d(oe()(g,{}))}),[g]),J=Object(r.useCallback)((function(){Y((function(e){return e.imageUrl=""})),F(void 0),T(void 0)}),[Y]),L=Object(r.useCallback)((function(e){Object(w.isNil)(e)||0===e.length||(Y((function(e){return e.imageUrl="".concat(De.a.generate(),".png")})),T(e[0]),function(e){var t=new Promise((function(t,n){var a=new FileReader;a.readAsArrayBuffer(e),a.onload=function(){return t(a.result)},a.onerror=function(e){return n(e)}}));return A.FromPromise(t).onSuccess((function(e){return Me(e)}))}(e[0]).onSuccess((function(e){F(e),U(void 0)})).onFailure((function(e){return U(e)})).run())}),[Y]),z=Object(r.useCallback)((function(){Te(g,D).onSuccess((function(e){return t(g,P)})).onFailure((function(e){return U(e)})).run()}),[t,g,P,D]),H=Object(r.useCallback)((function(){Object(w.isNil)(n)||_(B.areYouSureToDeleteWidget).onSuccess((function(e){return n()})).run()}),[_,n]);return o.a.createElement(b.a,{open:e.open,fullWidth:!0,maxWidth:"sm"},o.a.createElement(v.a,null,B.manageWidget,o.a.createElement(k,{error:x})),o.a.createElement(h.a,{dividers:!0},o.a.createElement(p.a,{container:!0,spacing:2,direction:"column"},o.a.createElement(xe,{label:B.title,value:g.title,country:e.country,onChange:function(e,t){return Y((function(n){return n.title[t]=e}))}}),o.a.createElement(ue,null),o.a.createElement(xe,{label:B.description,value:g.description,country:e.country,onChange:function(e,t){return Y((function(n){return n.description[t]=e}))}}),o.a.createElement(ue,null),o.a.createElement(p.a,{item:!0},o.a.createElement(E.a,{variant:"h6"},B.image)),o.a.createElement(p.a,{item:!0},o.a.createElement(E.a,{color:"textSecondary",variant:"subtitle2"},B.pngImagesOnly)),o.a.createElement(p.a,{item:!0,container:!0,alignContent:"center",justify:"center",alignItems:"center"},o.a.createElement(p.a,{item:!0,className:R.fileUploadContainer},o.a.createElement("input",{accept:"image/png",type:"file",onChange:function(e){return L(e.target.files)}})),g.imageUrl.length>0&&o.a.createElement(p.a,{item:!0},o.a.createElement(C.a,{variant:"contained",color:"secondary",onClick:J},B.removeImage))),o.a.createElement(ue,null),o.a.createElement(p.a,{item:!0},o.a.createElement(E.a,{variant:"h6"},B.moreButton)),o.a.createElement(p.a,{item:!0},o.a.createElement(y.a,{fullWidth:!0,label:B.link,type:"text",variant:"outlined",value:g.button.url,error:0===g.button.url.length,onChange:function(e){return Y((function(t){return t.button.url=e.target.value}))}})),o.a.createElement(xe,{value:g.button.title,country:e.country,onChange:function(e,t){return Y((function(n){return n.button.title[t]=e}))}}),o.a.createElement(ue,null),o.a.createElement(p.a,{item:!0},o.a.createElement(E.a,{variant:"h6"},B.audience)),o.a.createElement(p.a,{item:!0},o.a.createElement(je.a,{value:g.audience,onChange:function(e){return Y((function(t){return t.audience=e.target.value}))},fullWidth:!0,variant:"outlined"},Object.values(a).map((function(e){return o.a.createElement(Ce.a,{key:e,value:e},e)})))),o.a.createElement(ue,null),o.a.createElement(We,{title:B.fromDate,value:g.fromDate,onChange:function(e){return Y((function(t){return t.fromDate=e}))}}),o.a.createElement(ue,null),o.a.createElement(We,{title:B.tillDate,value:g.tillDate,onChange:function(e){return Y((function(t){return t.tillDate=e}))}}))),o.a.createElement(O.a,null,!Object(w.isNil)(e.onDelete)&&o.a.createElement(C.a,{variant:"contained",color:"secondary",onClick:H},B.deleteWidget),o.a.createElement(C.a,{variant:"contained",onClick:e.onCancel},B.cancel),o.a.createElement(C.a,{variant:"contained",color:"primary",onClick:z},B.save)))},Ue=Object(N.a)((function(e){return{wrapper:{marginRight:e.spacing(2)},container:{width:365,height:224,backgroundColor:"black",borderRadius:8,backgroundSize:"cover",backgroundPosition:"center"},contentContainer:{padding:e.spacing(5),height:"100%"},title:{textAlign:"center",color:"white"},description:{textAlign:"center",color:"white"},button:{backgroundColor:"white",borderRadius:e.spacing(2),color:"black",padding:e.spacing(1),"&:hover":{textDecoration:"none"}},actionsContainer:{padding:e.spacing(1),minHeight:e.spacing(10)},containerInactive:{opacity:.2}}})),Re=function(e){var t=e.onChanged,n=e.onCopy,a=e.onDelete,i=Ue(),c=Ee(e.country,e.widget.title),u=Ee(e.country,e.widget.description),l=Ee(e.country,e.widget.button.title),s=Object(r.useMemo)((function(){return e.imageBase64&&'url("data:image/png;base64,'.concat(e.imageBase64,'")')}),[e.imageBase64]),m=Object(r.useMemo)((function(){return"".concat(pe.a.utc(e.widget.fromDate).format("ll")," - ").concat(pe.a.utc(e.widget.tillDate).format("ll"))}),[e.widget.fromDate,e.widget.tillDate]),g=Object(r.useMemo)((function(){var t=pe.a.utc();return t.isSameOrAfter(e.widget.fromDate)&&t.isSameOrBefore(e.widget.tillDate)}),[e.widget.fromDate,e.widget.tillDate]),d=Object(r.useMemo)((function(){return"".concat(i.container," ").concat(g?"":i.containerInactive)}),[g,i.container,i.containerInactive]),b=Object(r.useState)(!1),v=Object(f.a)(b,2),h=v[0],y=v[1],O=Object(r.useState)(!1),S=Object(f.a)(O,2),w=S[0],k=S[1],D=Object(r.useCallback)((function(e,n){t(e,n),y(!1)}),[t]),T=Object(r.useCallback)((function(t){n(t,e.widget,e.imageBase64),k(!1)}),[n,e.widget,e.imageBase64]),N=Object(r.useCallback)((function(){a(),y(!1)}),[a]),M=Oe()(),P=Object(f.a)(M,2),F=P[0],I=P[1];return o.a.createElement(ve.a,Object.assign({className:i.wrapper},I),o.a.createElement(ve.a,{className:d,style:{backgroundImage:s}},o.a.createElement(p.a,{container:!0,direction:"column",alignItems:"center",justify:"space-between",className:i.contentContainer},o.a.createElement(p.a,{item:!0},o.a.createElement(E.a,{className:i.title,variant:"h5",gutterBottom:!0},c)),o.a.createElement(p.a,{item:!0},o.a.createElement(E.a,{className:i.description,variant:"body1",gutterBottom:!0},u)),o.a.createElement(p.a,{item:!0},o.a.createElement(E.a,null,o.a.createElement(j.a,{className:i.button,target:"_blank",href:e.widget.button.url},l))))),o.a.createElement(p.a,{container:!0,className:i.actionsContainer,spacing:1,alignContent:"center",alignItems:"center"},o.a.createElement(p.a,{item:!0},o.a.createElement(E.a,{variant:"subtitle2",color:"textSecondary"},e.widget.audience),o.a.createElement(E.a,{variant:"subtitle2",color:"textSecondary"},m)),F&&o.a.createElement(r.Fragment,null,o.a.createElement(p.a,{item:!0},o.a.createElement(C.a,{variant:"contained",onClick:function(){return y(!0)}},B.edit)),o.a.createElement(p.a,{item:!0},o.a.createElement(C.a,{variant:"contained",onClick:function(){return k(!0)}},B.copy)))),o.a.createElement(Be,{country:e.country,widget:e.widget,open:h,onCancel:function(){return y(!1)},onSave:D,onDelete:N}),o.a.createElement(we,{country:e.country,open:w,onCancel:function(){return k(!1)},onCopy:function(e){return T(e)}}))},_e=Object(N.a)((function(e){return{widgetsContainer:{display:"flex",overflowX:"auto",overflowY:"hidden",marginTop:e.spacing(2)},headerContainer:{marginTop:e.spacing(2)}}})),Ye=function(e){var t=me(),n=Object(m.useSnackbar)(),a=e.onCreateWidget,i=e.onRevertChanges,c=e.onCopyWidget,u=e.onDeleteWidget,l=e.onWidgetChanged,s=e.onWidgetReordered,g=e.onPublishChangesAsync,d=_e(),b=Object(r.useState)(!1),v=Object(f.a)(b,2),h=v[0],y=v[1],O=Object(r.useState)(!1),j=Object(f.a)(O,2),S=j[0],k=j[1],D=Object(r.useState)(de(e.country)),T=Object(f.a)(D,2),N=T[0],M=T[1],F=Object(r.useState)(new Map),I=Object(f.a)(F,1)[0],W=Object(r.useCallback)((function(){M(de(e.country)),k(!0)}),[e.country]),x=Object(r.useCallback)((function(e,t){a(e,t),k(!1)}),[a]),A=function(e){return I.get(e)||I.set(e,Object(se.a)()).get(e)||""},U=Object(r.useCallback)((function(e){Object(w.isNil)(e.destination)||s(e.source.index,e.destination.index)}),[s]),R=Object(r.useCallback)((function(){t("".concat(B.areYouSureToRevert," ").concat(e.name,"?")).onSuccess((function(e){return i()})).run()}),[e.name,t,i]),_=Object(r.useCallback)((function(){t("".concat(B.areYouSureToPublish," ").concat(e.name,"?")).onSuccess((function(e){return y(!0),g().onFailure((function(e){return n.showMessage(B.somethingWentWrong)}))})).onSuccess((function(e){n.showMessage(B.successfullyPublished)})).onBoth((function(e){return y(!1)})).run()}),[g,e.name,t,n]);return o.a.createElement(p.a,{container:!0,direction:"column"},o.a.createElement(p.a,{container:!0,item:!0,spacing:3,alignContent:"center",className:d.headerContainer},o.a.createElement(p.a,{item:!0},o.a.createElement(E.a,{variant:"h5",gutterBottom:!0},e.name)),o.a.createElement(p.a,{item:!0},o.a.createElement(C.a,{variant:"contained",onClick:W},B.createWidget)),e.hasChanges&&o.a.createElement(r.Fragment,null,o.a.createElement(p.a,{item:!0},o.a.createElement(C.a,{variant:"contained",color:"primary",onClick:_},B.publishChanges)),o.a.createElement(p.a,{item:!0},o.a.createElement(C.a,{variant:"contained",color:"secondary",onClick:R},B.revertChanges)))),o.a.createElement(p.a,{item:!0},o.a.createElement(le.a,{onDragEnd:U},o.a.createElement(le.c,{droppableId:"droppable",direction:"horizontal"},(function(t){return o.a.createElement("div",Object.assign({ref:t.innerRef,className:d.widgetsContainer},t.droppableProps),e.widgets.map((function(t,n){return o.a.createElement(le.b,{key:A(t),draggableId:A(t),index:n},(function(a){var r;return o.a.createElement("div",Object.assign({ref:a.innerRef},a.draggableProps,a.dragHandleProps),o.a.createElement(Re,{key:"".concat(t.title,"-").concat(n),country:e.country,imageBase64:(null===(r=e.imageUrlToBase64Map[t.imageUrl])||void 0===r?void 0:r.value)||"",widget:t,onChanged:function(e,t){return l(n,e,t)},onCopy:function(e,t,n){return c(e,t,n)},onDelete:function(){return u(n)}}))}))})),t.placeholder)})))),o.a.createElement(Be,{country:e.country,widget:N,open:S,onCancel:function(){return k(!1)},onSave:function(e,t){return x(e,t)}}),o.a.createElement(P,{visible:h}))};Date.prototype.toJSON=function(){return pe()(this).utc().format("YYYY-MM-DD HH:mm:ss").replace(" ","T")};var Je=JSON.parse,Le=function(e,t){return Je(e,(function(e,n){return t&&t(e,n)||function(e,t){return"string"!==typeof t?t:pe.a.utc(t.replace("T"," "),"YYYY-MM-DD HH:mm:ss").format("YYYY-MM-DD HH:mm:ss")===t?pe.a.utc(t,"YYYY-MM-DD HH:mm:ss").toDate():t}(0,n)}))};JSON.parse=Le;var ze=function(e,t){var n={path:"".concat(V,"repos/").concat("LibertyGlobal","/").concat(e,"/contents/").concat(t),method:"GET",useAuthorization:!0};return G(n)},He=function(e){return"".concat("capp-instantWidgets-").concat(e.toLowerCase())},Ge=function(e){return"".concat(e,".json")},Ke=function(e,t){var n=t.name.split(".")[0];return Xe(t.download_url).onSuccess((function(e){return Le(e)})).onFailureCompensate((function(e){return[]})).onSuccess((function(a){return qe(e,n,a).onSuccess((function(e){return{name:n,sha:t.sha,widgets:a,hasChanges:!1,imageUrlToBase64Map:Ve(e)}}))}))},Ve=function(e){return Array.from(e).reduce((function(e,t){var n=Object(f.a)(t,2),a=n[0],r=n[1];return Object.assign(e,Object(fe.a)({},a,{sha:r.sha,value:r.value}))}),{})},qe=function(e,t,n){var a=n.filter((function(e){return e.imageUrl})).map((function(e){return e.imageUrl})).reduce((function(e,t){return e.add(t)&&e}),new Set);return ze(e,"images/".concat(t)).onFailureCompensate((function(e){return[]})).onSuccess((function(e){return e.filter((function(e){return a.has(e.name)}))})).onSuccess((function(e){return A.Combine(e.map((function(e){return $e(e.download_url).onSuccess((function(t){return{name:e.name,value:t,sha:e.sha}}))}))).onSuccess((function(e){var t=new Map;return e.forEach((function(e,n){return t.set(e.name,{value:e.value,sha:e.sha})})),t}))}))},Xe=function(e){return J({path:e,method:"GET",ignoreCacheControl:!0}).onSuccess((function(e){return e.text()}))},$e=function(e){return J({path:e,method:"GET",ignoreCacheControl:!0}).onSuccess((function(e){return e.arrayBuffer()})).onSuccess((function(e){return Me(e)}))},Qe=function(e,t,n,a){var r={path:"".concat(V,"repos/").concat("LibertyGlobal","/").concat(e,"/contents/").concat(t),method:"PUT",body:{message:"Publish changes",content:n,sha:a},useAuthorization:!0,useJsonContentType:!0};return G(r).onSuccess((function(e){return e.content.sha}))},Ze=function(e,t,n){var a=He(e),r=t.widgets.map((function(e){return e.imageUrl})).filter((function(e){return!Object(w.isNil)(t.imageUrlToBase64Map[e])&&Object(w.isNil)(n.imageUrlToBase64Map[e])})),o=new Map;return A.Combine(r.map((function(e){return Qe(a,"images/".concat(t.name,"/").concat(e),t.imageUrlToBase64Map[e].value,t.imageUrlToBase64Map[e].sha).onSuccess((function(t){return o.set(e,t)}))}))).onSuccess((function(e){return Qe(a,Ge(t.name),btoa(JSON.stringify(t.widgets,void 0,4)),t.sha)})).onSuccess((function(e){return function(e,t){var n={path:"".concat(V,"repos/").concat("LibertyGlobal","/").concat(e,"/releases"),method:"POST",body:{tag_name:"".concat(t,"_").concat(pe.a.utc().unix())},useAuthorization:!0,useJsonContentType:!0};return J(n).void}(a,t.name).withOverridenValue(e)})).onSuccess((function(e){return{environmentSha:e,imagesUrlToShaMap:o}}))},et=Object(N.a)((function(e){return{container:{margin:e.spacing(4)}}})),tt=function(){var e=function(e){var t=Object(d.f)();return Object(r.useMemo)((function(){return Object(w.isNil)(t)||Object(w.isNil)(t.params)?void 0:t.params[e]}),[t,e])}("country"),t=Object(r.useState)(!1),n=Object(f.a)(t,2),a=n[0],i=n[1],c=Object(r.useState)(),u=Object(f.a)(c,2),l=u[0],s=u[1],m=Object(r.useState)(),g=Object(f.a)(m,2),b=g[0],v=g[1],h=Object(r.useState)(),y=Object(f.a)(h,2),O=y[0],E=y[1];Object(r.useEffect)((function(){if(_.debug){var t=localStorage.getItem(_.debugDataKey);if(t){var n=Le(t);return v(n),void E(oe()(n,{}))}}else localStorage.removeItem(_.debugCountryKey),localStorage.removeItem(_.debugDataKey);Object(w.isNil)(e)?s(B.somethingWentWrong):(i(!0),function(e){var t=He(e),n=Se(e),a=n.map((function(e){return Ge(e)})),r=new Map;return ze(t,"").onSuccess((function(e){return e.filter((function(e){return a.some((function(t){return t===e.name}))}))})).onSuccess((function(e){return A.Combine(e.map((function(e){return Ke(t,e).onSuccess((function(e){return r.set(e.name,e)}))}))).onSuccess((function(e){return n.compactMap((function(e){return r.get(e)}))}))})).onSuccess((function(t){return{country:e,environments:t}})).withOverridenError(B.somethingWentWrong)}(e).onSuccess((function(t){_.debug&&(t.environments.forEach((function(e){return e.imageUrlToBase64Map={}})),localStorage.setItem(_.debugCountryKey,e),localStorage.setItem(_.debugDataKey,JSON.stringify(t))),v(t),E(oe()(t,{}))})).onFailure((function(e){return s(e)})).onBoth((function(e){return i(!1)})).run())}),[e]);var j=Object(r.useCallback)((function(e,t,n,a,r){if(!Object(w.isNil)(b)&&!Object(w.isNil)(e)){if(!Object(w.isNil)(n)&&!Object(w.isNil)(t)){var o=e.imageUrlToBase64Map[t.imageUrl]||{};o.value=n,e.imageUrlToBase64Map[t.imageUrl]=o}a(e),e.hasChanges=r;var i=oe()(b,{});return v(i),i}}),[b]),C=Object(r.useCallback)((function(e,t,n,a){return j(null===b||void 0===b?void 0:b.environments[e],n,a,(function(e){return e.widgets[t]=n}),!0)}),[b,j]),S=Object(r.useCallback)((function(e,t,n){return j(null===b||void 0===b?void 0:b.environments.find((function(t){return t.name===e})),t,n,(function(e){return e.widgets.unshift(t)}),!0)}),[b,j]),D=Object(r.useCallback)((function(e,t){return j(t,void 0,void 0,(function(t){return t.widgets.splice(e,1)}),!0)}),[j]),T=Object(r.useCallback)((function(e,t,n){return j(e,t,n,(function(e){return e.widgets.unshift(t)}),!0)}),[j]),N=Object(r.useCallback)((function(e,t,n){return j(e,void 0,void 0,(function(e){return e.widgets.move(t,n)}),!0)}),[j]),M=Object(r.useCallback)((function(e){return j(e,void 0,void 0,(function(t){var n=null===O||void 0===O?void 0:O.environments.find((function(t){return t.name===e.name}));Object(w.isNil)(n)||(t.widgets=oe()(n.widgets,[]),t.imageUrlToBase64Map=oe()(n.imageUrlToBase64Map,{}))}),!1)}),[j,O]),F=Object(r.useCallback)((function(t){var n=null===O||void 0===O?void 0:O.environments.find((function(e){return e.name===t.name}));return Object(w.isNil)(e)||Object(w.isNil)(n)||Object(w.isNil)(b)?A.Fail(B.somethingWentWrong):Ze(e,t,n).onSuccess((function(e){return j(t,void 0,void 0,(function(t){t.sha=e.environmentSha,Object.keys(t.imageUrlToBase64Map).forEach((function(n){var a=e.imagesUrlToShaMap.get(n);Object(w.isNil)(a)||(t.imageUrlToBase64Map[n].sha=a)}))}),!1)})).onSuccess((function(e){Object(w.isNil)(e)||E(oe()(e,{}))}))}),[O,e,b,j]),I=et();return o.a.createElement(p.a,{container:!0,direction:"column",className:I.container},o.a.createElement(k,{error:l}),o.a.createElement(P,{visible:a}),!Object(w.isNil)(e)&&!Object(w.isNil)(b)&&b.environments.map((function(t,n){return o.a.createElement(r.Fragment,{key:t.name},o.a.createElement(Ye,Object.assign({country:e},t,{onWidgetChanged:function(e,t,a){return C(n,e,t,a)},onCopyWidget:S,onDeleteWidget:function(e){return D(e,t)},onCreateWidget:function(e,n){return T(t,e,n)},onWidgetReordered:function(e,n){return N(t,e,n)},onRevertChanges:function(){return M(t)},onPublishChangesAsync:function(){return F(t)}})),o.a.createElement(ue,null))})))},nt=function(){var e=Object(r.useState)(!1),t=Object(f.a)(e,2),n=t[0],a=t[1];return o.a.createElement(g.a,null,!n&&o.a.createElement(ae,{onCompleted:function(){return a(!0)}}),n&&o.a.createElement(r.Fragment,null,o.a.createElement(d.a,{path:"/login",component:Q,exact:!0}),o.a.createElement(d.a,{path:"/pick",component:ne,exact:!0}),o.a.createElement(d.a,{path:"/manage/country/:country",component:tt,exact:!0})))},at=n(101),rt=Object(at.a)({}),ot=function(){return o.a.createElement(r.Fragment,null,o.a.createElement(u.a,{theme:rt},o.a.createElement(s.a,null,o.a.createElement(m.SnackbarProvider,{SnackbarProps:{autoHideDuration:4e3,anchorOrigin:{vertical:"top",horizontal:"center"}}},o.a.createElement(l.a,null),o.a.createElement(nt,null)))))};Array.prototype.compactMap=function(e,t){var n=new Array;return this.forEach((function(a){var r=e(a);!0===t?Object(w.isNil)(r)||n.push(r):r&&n.push(r)})),n},Array.prototype.move=function(e,t){return this.splice(t,0,this.splice(e,1)[0]),this};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(ot,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[123,1,2]]]);
//# sourceMappingURL=main.60077dd0.chunk.js.map